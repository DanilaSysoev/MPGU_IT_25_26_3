# üîê –ó–ê–ù–Ø–¢–ò–ï 2 ‚Äî –ö–õ–Æ–ß–ò, –¢–û–ö–ï–ù–´ –ò –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ï–ö–†–ï–¢–ê–ú–ò

## 1. –¶–µ–ª—å

–ü–æ–Ω—è—Ç—å, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

* —Ö—Ä–∞–Ω–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏;
* —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã (session, bearer, JWT);
* –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å–∏ –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–æ–≤;
* –∑–∞—â–∏—â–∞—Ç—å –∫–ª—é—á–∏ –æ—Ç —É—Ç–µ—á–∫–∏.

---

## 2. –¢–∏–ø–∏—á–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

1. –ö–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ –∏–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
2. –¢–æ–∫–µ–Ω—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã (base64 –±–µ–∑ HMAC).
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞.
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, user_id + timestamp).
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ¬´None¬ª –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≤ JWT.
6. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤.

---

## 3. –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è

* **–°–µ–∫—Ä–µ—Ç (Secret key)** ‚Äî —Å—Ç—Ä–æ–∫–∞, –∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä—É, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∏.
* **–ü–æ–¥–ø–∏—Å—å (HMAC)** ‚Äî —Å–ø–æ—Å–æ–± —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–¥–¥–µ–ª–∞–Ω—ã.
* **–¢–æ–∫–µ–Ω** ‚Äî —Å—Ä–µ–¥—Å—Ç–≤–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –ø–∞—Ä–æ–ª—è.
* **JWT (JSON Web Token)** ‚Äî —Ç–æ–∫–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON, –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π HMAC –∏–ª–∏ RSA.

---

## 4. HMAC (Hash-based Message Authentication Code)

–§–æ—Ä–º—É–ª–∞:

```
HMAC = hash(secret + message)
```

**–ó–∞—á–µ–º –Ω—É–∂–µ–Ω:**
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ API –∏ JWT.

**–ü—Ä–∏–º–µ—Ä:**

```python
import hmac, hashlib

msg = b"username=admin"
secret = b"topsecret"
signature = hmac.new(secret, msg, hashlib.sha256).hexdigest()
```

---

## 5. Base64 ‚â† –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ú–Ω–æ–≥–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥—É–º–∞—é—Ç, —á—Ç–æ —Ç–æ–∫–µ–Ω –≤—Ä–æ–¥–µ

```python
token = base64.b64encode(f"{username}:{timestamp}".encode())
```

–±–µ–∑–æ–ø–∞—Å–µ–Ω.
–ù–æ base64 ‚Äî **–ø—Ä–æ—Å—Ç–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ**, –Ω–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ.
–ï–≥–æ –º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –∏–∑–º–µ–Ω–∏—Ç—å.

---

## 6. JWT (JSON Web Token)

JWT —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 3 —á–∞—Å—Ç–µ–π:

```
header.payload.signature
```

### –ü—Ä–∏–º–µ—Ä:

```
eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1c2VyMSIsImlhdCI6MTcxNjA3NDI2OSwiZXhwIjoxNzE2MDc0ODI5fQ.NL56M0U0...
```

### –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
import jwt
SECRET = "mysecret"
payload = jwt.decode(token, SECRET, algorithms=["HS256"])
```

---

## 7. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ JWT

* –°–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω: –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
* –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (`exp`).
* –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å—å –±–µ–∑ –ë–î.

---

## 8. –û–ø–∞—Å–Ω–æ—Å—Ç–∏ JWT

1. –ê–ª–≥–æ—Ä–∏—Ç–º `"none"` ‚Üí —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å.
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Å–∏–º–º–µ—Ç—Ä–∏–∏ –∫–∞–∫ —Å–∏–º–º–µ—Ç—Ä–∏–∏ (–ø–æ–¥–º–µ–Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞).
3. –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ (`exp` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç).
4. –£—Ç–µ—á–∫–∞ `SECRET_KEY`.

---

## 9. –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã

| –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ                      | –ü—Ä–∞–≤–∏–ª—å–Ω–æ                         |
| -------------------------------- | --------------------------------- |
| –í –∫–æ–¥–µ (`SECRET_KEY = "12345"`)  | –í .env —Ñ–∞–π–ª–µ                      |
| –í Git                            | –í secrets manager (Vault, AWS SM) |
| –í cookie –±–µ–∑ —Ñ–ª–∞–≥–æ–≤              | –° —Ñ–ª–∞–≥–∞–º–∏ Secure, HttpOnly        |
| –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω –±–µ–∑ —Ä–µ–≤–æ–∫–∞—Ü–∏–∏ | Refresh —Ç–æ–∫–µ–Ω —Å —Ä–æ—Ç–∞—Ü–∏–µ–π          |

–ü—Ä–∏–º–µ—Ä `.env`:

```
SECRET_KEY=change-me
JWT_EXPIRATION=600
```

---

## 10. Refresh —Ç–æ–∫–µ–Ω

* Access-—Ç–æ–∫–µ–Ω: –∂–∏–≤—ë—Ç 5‚Äì15 –º–∏–Ω—É—Ç.
* Refresh-—Ç–æ–∫–µ–Ω: –∂–∏–≤—ë—Ç –¥–æ–ª—å—à–µ, —Ö—Ä–∞–Ω–∏—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ.
* –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ access-—Ç–æ–∫–µ–Ω–∞ ‚Äî refresh –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–æ–≤—ã–º (rotate-on-use).

---

## 11. –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π

* –°—Ç–∞—Ä—ã–π –∫–ª—é—á ‚Üí `kid=1`, –Ω–æ–≤—ã–π ‚Üí `kid=2`.
* –°–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç –æ–±–∞ –∏ –º–æ–∂–µ—Ç –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã.
* –ü—Ä–∏ –¥–µ–ø–ª–æ–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∫–ª—é—á–∏ –±–µ–∑ ¬´–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞¬ª –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## 12. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤

```python
def verify_token(token):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
        return payload
    except jwt.ExpiredSignatureError:
        raise Unauthorized("Token expired")
    except jwt.InvalidTokenError:
        raise Unauthorized("Invalid token")
```

---

## 13. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

* –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS.
* –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ URL.
* –î–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ ‚Äî –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ cookie —Å HttpOnly + Secure.

---

## 14. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã

‚úÖ –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ.<br/>
‚úÖ –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Base64 –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∑–∞—â–∏—Ç—ã.<br/>
‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (`exp`).<br/>
‚úÖ –†–µ–∞–ª–∏–∑—É–π—Ç–µ refresh flow –∏ revocation list.<br/>
‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∫–ª—é—á–∏.<br/>
‚úÖ –õ–æ–≥–∏—Ä—É–π—Ç–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–∫–µ–Ω–æ–≤, –∞ —Ç–æ–ª—å–∫–æ `sub` –∏–ª–∏ `kid`.<br/>

---

## 15. –î–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è

* –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ `SECRET_KEY` —É—Ç–µ—á—ë—Ç?
* –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ localStorage?
* –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É ‚Äú—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω‚Äù –∏ ‚Äú–ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å —Ç–æ–∫–µ–Ω‚Äù?

---

## 16. –î–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è

* [OWASP JSON Web Token Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/JSON_Web_Token_Cheat_Sheet_for_Java.html)
* [OWASP Cryptographic Storage Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html)
* [RFC 7519: JSON Web Token (JWT)](https://datatracker.ietf.org/doc/html/rfc7519)

---

## 17. –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å –≤ HMAC?
2. –ü–æ—á–µ–º—É base64-—Ç–æ–∫–µ–Ω –ª–µ–≥–∫–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å?
3. –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞—Ä–µ–ª?
4. –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π?
5. –ü–æ—á–µ–º—É —Å–µ–∫—Ä–µ—Ç –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ Git?

---
