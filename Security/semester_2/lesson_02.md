# Урок 2. Права доступа и основы администрирования

**Тип занятия:** Воркшоп (Workshop)  
**Продолжительность:** 3 астрономических часа (180 мин)  
**Сложность:** Средняя (требует внимания к деталям)  
**Ключевой навык:** Принцип наименьших привилегий (Principle of Least Privilege).  
**Дедлайн по ДЗ:** 1 неделя  

---

## 1. Конспект занятия (План для преподавателя)

### Часть 1. Пользователи: Кто в доме хозяин? (40 мин)

*Цель: Понять разницу между Root и обычным пользователем. Научиться создавать "соседей".*

**Тезисы:**

1. **Многопользовательская архитектура:** Linux — это общежитие. Есть комендант (`root`), у которого ключи от всех комнат. Есть жильцы (обычные юзеры).
2. **UID/GID:** Компьютер не знает имен «Ivan» или «Admin». Он знает цифры. `root` всегда имеет UID 0.
3. **Опасность Root:**
    * *Аналогия:* Работа под рутом — это нарезка хлеба бензопилой без защитного кожуха. Одно неверное движение — и системы нет.
4. **Команды:**
    * `whoami` — кто я?
    * `id` — мои группы и UID.
    * `useradd -m -s /bin/bash newuser` — создание пользователя (с домашней папкой).
    * `passwd newuser` — смена пароля.
    * `su - newuser` — переключение (Switch User).

**Практика:**
Создаем пользователя `intern` (стажер). Заходим под ним. Пытаемся прочитать файлы администратора (если права позволяют) или установить программу. Получаем "Permission denied". Радуемся.

### Часть 2. Магия Chmod: Чтение, Запись, Исполнение (60 мин)

*Цель: Разобраться в `rwx` и научиться считать права в уме.*

**Тезисы:**

1. **Триада прав:** `r` (read), `w` (write), `x` (execute).
2. **Три уровня доступа:**
    * **U**ser (Владелец файла).
    * **G**roup (Группа владельца — коллеги).
    * **O**ther (Все остальные — мир).
3. **Чтение вывода `ls -l`:** Разбираем строку `-rwxr-xr--`.
4. **Восьмеричная система (Octal):**
    * r = 4, w = 2, x = 1.
    * rw- = 4+2 = 6.
    * rwx = 7.
    * **Почему `chmod 777` — это преступление.** Это значит: "Любой хакер, попавший на сервер, может записать сюда свой вирус и запустить его".
5. **Владение:** Команда `chown user:group file`.

**Практика:**

* Создаем файл `secret_data.txt`.
* Ставим права `600` (только я читаю и пишу).
* Пытаемся прочитать его другим пользователем.
* Делаем скрипт `hello.sh`, даем ему `+x` и запускаем.

### Часть 3. SSH: Ключи вместо паролей (50 мин)

*Цель: Настроить безопасный вход. Пароли можно сбрутить, ключи — (почти) нет.*

**Тезисы:**

1. **Асимметричное шифрование на пальцах:**
    * *Публичный ключ (Public)* — это замок. Его можно раздавать всем. "Поставь этот замок на свою дверь".
    * *Приватный ключ (Private)* — это ключ от замка. Хранится под подушкой, никому не дается.
2. **Генерация:** `ssh-keygen -t ed25519` (современный стандарт) или `rsa`.
3. **Куда класть:** Папка `~/.ssh/`. Файл `authorized_keys`.
4. **Критические права:** Если права на папку `.ssh` будут слишком открытыми (например, 777), SSH-сервер откажется работать из соображений безопасности. Это частая боль новичков.

**Практика:**

* Генерируем пару ключей.
* Смотрим на "красивую картинку" (randomart).
* Изучаем содержимое `.pub` файла.
* (Опционально для WSL/Локалки) Эмулируем копирование ключа: `cat id_ed25519.pub >> authorized_keys`.

### Часть 4. Основы сетевой безопасности (UFW/Ports) (30 мин)

*Цель: Понять концепцию портов.*

**Тезисы:**

1. **Порты:** Это двери в квартиру. Веб-сервер — порт 80. SSH — 22. БД — 5432.
2. **Firewall:** Это вахтер. "Ты кто? Тебе на 22? Проходи. На 3306? Не пущу".
3. **Команда `netstat -tulpn` или `ss`:** Посмотреть, кто "слушает" сеть.

---

## 2. Домашнее задание №2: «Сейф»

**Легенда:**
В вашей компании появился новый сотрудник — Стажер (пользователь `intern`). Вы — Администратор (`admin` или ваш текущий юзер). Ваша задача: создать защищенное хранилище документов, куда Стажер не сможет засунуть свой нос, и настроить себе безопасный вход по ключам.

**Задание:**

1. **Управление пользователями:**
    * Создайте нового пользователя в системе с именем `intern`.
    * Установите ему любой пароль.

2. **Файловые права (Сценарий):**
    * В своей домашней директории создайте папку `top_secret`.
    * Внутри создайте файл `codes.txt` с текстом "Super Secret Launch Codes".
    * **Задача:** Настройте права (`chmod`) на файл `codes.txt` и папку `top_secret` так, чтобы:
        * Вы могли читать и редактировать файл.
        * Пользователь `intern` **не мог** даже войти в папку `top_secret`, не говоря уже о чтении файла.
    * *Проверка:* Попробуйте сменить пользователя (`su - intern`) и прочитать файл (`cat /home/ваш_юзер/top_secret/codes.txt`). Должно быть сообщение об ошибке.

3. **SSH и безопасность ключей:**
    * Сгенерируйте пару SSH-ключей (тип ED25519 или RSA) для своего основного пользователя.
    * Создайте (если нет) папку `.ssh` и файл `authorized_keys` внутри неё.
    * **Важно:** Установите правильные права доступа:
        * Папка `.ssh`: `700` (`drwx------`)
        * Файл `authorized_keys`: `600` (`-rw-------`)
        * Приватный ключ: `600`
    * Скопируйте содержимое вашего *публичного* ключа в `authorized_keys`.

4. **Отчет:**
    * Лог ваших действий.

**Формат сдачи:**
Markdown-файл (`report_02.md`) со скриншотами или копипастом из терминала:

1. Вывод команды `ls -ld top_secret` (показать права на папку).
2. Вывод команды `ls -l top_secret/codes.txt` (показать права на файл).
3. Скриншот попытки чтения файла от имени пользователя `intern` (с ошибкой `Permission denied`).
4. Вывод команды `ls -la ~/.ssh` (показать права на ключи).

---

## 3. Критерии оценивания (Максимум 8 баллов)

| Критерий | Баллы | Описание |
| :--- | :---: | :--- |
| **Создание пользователя** | **1** | Пользователь `intern` создан (видно в логах или в `/etc/passwd`). |
| **Создание секретов** | **1** | Папка `top_secret` и файл созданы. |
| **Настройка прав (Chmod)** | **2** | Права на секретную папку/файл настроены корректно (например, `700` на папку, `600` на файл). Другие пользователи (group/other) не имеют прав `r` или `x`. |
| **Демонстрация защиты** | **2** | Предоставлено доказательство (скриншот), что `intern` получил `Permission denied` при попытке доступа. Это главный критерий успеха. |
| **Генерация ключей** | **1** | Ключи SSH сгенерированы. |
| **Права на .ssh** | **1** | Права на папку `.ssh` (`700`) и ключи (`600`) выставлены идеально верно. |
| **Итого** | **8** | |

### Штрафы (вычитаются из суммы)

* **-2 балла:** Использование прав `777` на любом этапе выполнения (кроме демонстрации ошибки).
* **-1 балл:** Работа постоянно из-под `root` (символ `#` в консоли), кроме команд создания пользователя. Все файловые операции должны делаться обычным пользователем.
* **-1 балл:** Публикация приватного ключа в отчете (если студент скопировал в отчет содержимое `id_rsa` вместо `id_rsa.pub`). За это нужно бить по рукам сразу.

---

## Дополнительные материалы для студентов

1. **Статья:** "Права доступа в Linux (chmod, chown, группы) для новичков".
2. **Инструмент:** [Chmod Calculator](https://chmod-calculator.com/) — визуальный калькулятор прав.
3. **Документация:** `man chmod`, `man ssh-keygen`.
